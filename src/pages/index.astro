---
import "../styles/global.css";
const BASE = import.meta.env.BASE_URL || '/';
const norm = (p) => {
  if (!p) return BASE;
  const b = BASE.endsWith('/') ? BASE : BASE + '/';
  return b === '/' ? (p.startsWith('/') ? p : '/' + p) : b.replace(/\/$/, '') + (p.startsWith('/') ? p : '/' + p);
};
const homeHref = norm('/');
const projectsHref = norm('/projects');
const aboutHref = norm('/about');
const img1 = norm('/images/project01-thumb.png');
const img2 = norm('/images/project02-thumb.png');
const img3 = norm('/images/project03-thumb.png');
const img4 = norm('/images/project04-thumb.png');
const house1Href = norm('/projects/house-1');
const house2Href = norm('/projects/house-2');
const room1Href = norm('/projects/room-1');
const castle1Href = norm('/projects/castle-1');
---

<nav class="center-nav nav-light">
  <a href={homeHref}>Home</a>
  <a href={projectsHref}>Projects</a>
  <a href={aboutHref}>About</a>
</nav>

<section class="hero-fullscreen">
  <div class="hero-bg" aria-hidden="true" style={`background-image: url(${norm('/images/hero.jpg')})`}></div>
  <div class="hero-overlay"></div>
  <div class="hero-foreground" aria-hidden="true" style={`background-image: url(${norm('/images/hero.jpg')})`}></div>
  <div class="hero-text-content">
    <p class="hero-greeting">Welcome to</p>
    <h1 class="hero-name">
      <span class="digit-wrapper">
        <span class="digit" data-final="4">4</span>
      </span>
      <span class="digit-wrapper">
        <span class="digit" data-final="0">0</span>
      </span>
      <span class="digit-wrapper">
        <span class="digit" data-final="4">4</span>
      </span>
      <span class="studio-text">Studio</span>
    </h1>
    <p class="hero-tagline">Nice tagline here</p>
  </div>
</section>

<section class="featured-section">
  <h2 class="featured-title">Featured <strong>Portfolio</strong></h2>


  <div class="portfolio-grid">
  <a href={house1Href} class="portfolio-item">
    <img src={img1} alt="House 1" />
  <div class="portfolio-overlay">
  <h3>House 1</h3>
  <p>Residential Project</p>
  </div>
  </a>

  <a href={house2Href} class="portfolio-item">
    <img src={img2} alt="House 2" />
  <div class="portfolio-overlay">
  <h3>House 2</h3>
  <p>Residential Renovation</p>
  </div>
  </a>

  <a href={room1Href} class="portfolio-item">
    <img src={img3} alt="Room 1" />
  <div class="portfolio-overlay">
  <h3>Room 1</h3>
  <p>Multi-Unit Housing</p>
  </div>
  </a>

  <a href={castle1Href} class="portfolio-item">
    <img src={img4} alt="Castle 1" />
  <div class="portfolio-overlay">
  <h3>Castle 1</h3>
  <p>Civic / Cultural</p>
  </div>
  </a>
  </div>
</section>

<script is:inline src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<script is:inline src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
<script>
  if (typeof gsap === 'undefined') {
    console.warn('GSAP not loaded â€” animations disabled');
  } else {
    try {
      gsap.registerPlugin(ScrollTrigger);

      // Hero entrance
      gsap.from(".hero-greeting", {
        opacity: 0,
        y: 20,
        duration: 0.8,
        ease: "power2.out"
      });

      // Slot machine animation for 404
      const digits = document.querySelectorAll(".digit");
      digits.forEach((digit, index) => {
        const finalValue = parseInt(digit.dataset.final);
        const duration = 1.5 + (index * 0.2); // Stagger the settling time
        const spinCount = 15 + (index * 5); // Number of digit changes

        let counter = 0;
        const interval = setInterval(() => {
          digit.textContent = Math.floor(Math.random() * 10);
          counter++;

          if (counter >= spinCount) {
            clearInterval(interval);
            // Settle on final value with slight bounce
            gsap.to(digit, {
              textContent: finalValue,
              duration: 0.3,
              ease: "power2.out",
              onUpdate: function() {
                digit.textContent = Math.round(this.targets()[0].textContent);
              }
            });
          }
        }, 50); // Change digit every 50ms
      });

      // Fade in Studio text after digits settle
      gsap.from(".studio-text", {
        opacity: 0,
        x: -20,
        duration: 0.8,
        delay: 2,
        ease: "power2.out"
      });

      gsap.from(".hero-tagline", {
        opacity: 0,
        y: 20,
        duration: 0.8,
        delay: 2.2,
        ease: "power2.out"
      });

      // Scroll reveal
      gsap.from(".featured-title", {
        scrollTrigger: {
          trigger: ".featured-section",
          start: "top 90%",
          once: true
        },
        opacity: 0,
        y: 30,
        duration: 0.8,
        ease: "power2.out"
      });

      gsap.from(".portfolio-item", {
        scrollTrigger: {
          trigger: ".portfolio-grid",
          start: "top 90%",
          once: true
        },
        opacity: 0,
        y: 40,
        duration: 0.9,
        stagger: 0.15,
        ease: "power2.out"
      });

      // Refresh ScrollTrigger on orientation change to ensure positions recalc on mobile
      if (typeof window !== 'undefined') {
        window.addEventListener('orientationchange', () => {
          try{ ScrollTrigger.refresh(); } catch(e){}
        });
      }
    } catch (e) {
      console.warn('GSAP init failed', e);
    }
  }
</script>
