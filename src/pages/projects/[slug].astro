---
import "../../styles/global.css";

export async function getStaticPaths() {
  return [
    {
      params: { slug: 'house-1' },
      props: {
        title: 'House 1',
        year: '2017',
        location: 'F-8/3, Islamabad, Pakistan',
        type: 'Residential Project | Built',
        description: 'A compact residential project in Islamabad focusing on local climate, natural ventilation and layered indoor-outdoor living.',
        hero: '/images/project01-thumb.png',
        images: ['/images/project01-thumb.png', '/images/project01-thumb.png'],
        model: '/models/project01_desktop.glb'
      }
    },
    {
      params: { slug: 'house-2' },
      props: {
        title: 'House 2',
        year: '2017',
        location: 'G-6/4, Islamabad, Pakistan',
        type: 'Residential Renovation | Renovated',
        description: 'A renovation project in Islamabad that reconfigures existing spaces to improve daylighting, privacy and thermal comfort while respecting the original structure.',
        hero: '/images/project02-thumb.png',
        images: ['/images/project02-thumb.png', '/images/project02-thumb.png'],
        model: '/models/project02_desktop.glb'
      }
    },
    {
      params: { slug: 'room-1' },
      props: {
        title: 'Room 1',
        year: '2018',
        location: 'I-10 Sector, Islamabad, Pakistan',
        type: 'Multi-Unit Housing | Concept',
        description: 'A multi-unit housing concept exploring compact living and shared amenities suited to Islamabad suburbs.',
        hero: '/images/project03-thumb.png',
        images: ['/images/project03-thumb.png', '/images/project03-thumb.png'],
        model: '/models/project03_desktop.glb'
      }
    },
    {
      params: { slug: 'castle-1' },
      props: {
        title: 'Castle 1',
        year: '2019',
        location: 'Shakarparian Hills, Islamabad, Pakistan',
        type: 'Civic / Cultural | Built',
        description: 'A cultural pavilion sited on a hilltop, designed as a landmark gathering place responding to Islamabad\'s landscape and public program needs.',
        hero: '/images/project04-thumb.png',
        images: ['/images/project04-thumb.png', '/images/project04-thumb.png'],
        model: '/models/project04_desktop.glb'
      }
    }
  ];
}

const { title, year, location, type, description, hero, images, model } = Astro.props;
// Build-time base-aware resolver using Vite base (import.meta.env.BASE_URL)
const BASE = import.meta.env.BASE_URL || '/';
const norm = (p) => {
  if (!p) return BASE;
  const b = BASE.endsWith('/') ? BASE : BASE + '/';
  return b === '/' ? (p.startsWith('/') ? p : '/' + p) : b.replace(/\/$/, '') + (p.startsWith('/') ? p : '/' + p);
};
const homeHref = norm('/');
const projectsHref = norm('/projects');
const aboutHref = norm('/about');
const resolvedModel = model ? norm(model) : null;
const resolvedHero = hero ? norm(hero) : null;
const resolvedImages = Array.isArray(images) ? images.map(i => norm(i)) : [];
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{title} â€” Portfolio</title>
    <script is:inline src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script is:inline src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
  </head>
  <body>
    <nav class="center-nav">
      <a href={homeHref}>Home</a>
      <a href={projectsHref}>Projects</a>
      <a href={aboutHref}>About</a>
    </nav>

    <div class="project-intro">
      <section class="project-header">
        <h1 class="project-title">{title}</h1>
        <div class="project-meta">
          <div class="project-meta-item">
            <span class="project-meta-label">Year</span>
            <span class="project-meta-value">{year}</span>
          </div>
          <div class="project-meta-item">
            <span class="project-meta-label">Location</span>
            <span class="project-meta-value">{location}</span>
          </div>
          <div class="project-meta-item">
            <span class="project-meta-label">Type</span>
            <span class="project-meta-value">{type}</span>
          </div>
        </div>
        <p class="project-description">{description}</p>
      </section>

      <model-viewer
        src={resolvedModel}
        alt={`3D model of ${title}`}
        camera-controls
        auto-rotate
        shadow-intensity="1"
        style="width: 100%; height: 70vh;"
      ></model-viewer>
    </div>

    <section class="project-carousel">
      <div class="carousel-container">
        <div class="carousel-track">
          {resolvedImages.map((img, index) => (
            <div class="carousel-slide" data-index={index}>
              <img src={img} alt={title} />
            </div>
          ))}
        </div>
        <button class="carousel-arrow carousel-prev" aria-label="Previous image">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <button class="carousel-arrow carousel-next" aria-label="Next image">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>
    </section>

    <script is:inline>
      // Register GSAP plugins
      gsap.registerPlugin(ScrollTrigger);

      // Hero image / model fade in (only if element exists)
      const projectHero = document.querySelector('.project-hero');
      if (projectHero) {
        gsap.from(projectHero, {
          opacity: 0,
          duration: 1.5,
          ease: 'power2.out'
        });
      }

      // Metadata slides up (guarded)
      const projectHeader = document.querySelector('.project-header');
      if (projectHeader) {
        gsap.from(projectHeader, {
          opacity: 0,
          y: 30,
          duration: 1.2,
          delay: 0.3,
          ease: 'power2.out'
        });
      }

      // Centered carousel with auto-advance
      const track = document.querySelector('.carousel-track');
      const slides = document.querySelectorAll('.carousel-slide');
      const prevBtn = document.querySelector('.carousel-prev');
      const nextBtn = document.querySelector('.carousel-next');
      
      if (track && slides.length > 0) {
        let currentIndex = 0;
        let autoplayInterval;
        
        function goToSlide(index) {
          currentIndex = (index + slides.length) % slides.length;
          gsap.to(track, {
            x: -currentIndex * 100 + '%',
            duration: 0.8,
            ease: 'power2.inOut'
          });
        }
        
        function nextSlide() {
          goToSlide(currentIndex + 1);
        }
        
        function prevSlide() {
          goToSlide(currentIndex - 1);
        }
        
        function startAutoplay() {
          stopAutoplay();
          autoplayInterval = setInterval(nextSlide, 4000);
        }
        
        function stopAutoplay() {
          if (autoplayInterval) clearInterval(autoplayInterval);
        }
        
        nextBtn.addEventListener('click', () => {
          nextSlide();
          stopAutoplay();
          startAutoplay();
        });
        
        prevBtn.addEventListener('click', () => {
          prevSlide();
          stopAutoplay();
          startAutoplay();
        });
        
        startAutoplay();
      }
    </script>
  </body>
</html>
